# Web Application - Application Mapping

The second step in the process of attacking a web application is gathering and examining some key information about it to gain a better understanding of what
you are up against.

The mapping exercise begins by enumerating the applicationâ€™s content and
functionality in order to understand what the application does and
how it behaves.

--------------------------------------------------------------------------------
### Manual browsing + passive spidering

Browse the entire application in the normal way with BurpSuite active,
visiting every link and URL, submitting every form, and proceeding through all
multistep functions to completion.

If the application uses authentication, and you have or can create a login
account, use this to access the authenticated functionality.

###### Comments review
Review comments in HTML source code
```
<!--
//
/*
```

###### Robots.txt
The configuration files below may be used by the web application to give
information about the accessible and disallowed URI to search engines:
```
/robots.txt
/sitemap.xml
```

###### JS & Cookies
Browse with JavaScript enabled and disabled, and with cookies enabled and
disabled.

###### User-Agent
Change the User-Agent header to identify difference in comportment (for
example, the application may have a mobile version).  
Firefox addon that allows for quickly changing the browser's user agent string:
`User Agent Switcher`

*Agents*
```
# Browser
Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0

# Mobile
Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1
```

###### Debug parameters
Choose one or more functionalities where hidden debug parameters may be
implemented.
Use "Cluster bomb" attack type in Burp Intruder and the following common debug
parameter names with common values (such as true, yes, on, and 1):
```
debug
test
hide
hidden
source
```
For POST requests, supply the parameter in both the URL query string and the
request body.

###### Burp Passive Spidering
Review the site map generated by the passive spidering, and identify any
content or functionality that you have not walked through using your browser.

### OSINT

###### Search engines dorks

Returns every resource within the target site that Google has a reference to:
```
site:www.target.com
```

Returns all the pages containing the expression specified referenced by Google:
```
site:www.target.com login
site:www.target.com password
site:www.target.com config
site:www.target.com backup
```

Returns all the pages on other websites and applications that contain a link
to the target:
```
link:www.target.com
```
Browse to the last page of search results for a given query, and select
"Repeat the Search with the Omitted Results Included".

###### Accounts & emails scraping
Open resources such as Google, Bing, linkedin, twitter, etc can be used to
harvest accounts and emails associated to a domain.  
Those credentials may be used to conduct bruteforce attack subsequently.
The tools below automate this scraping:
```
theHarvester.py -d <target_domain.com> -b all -l 400
```

### Fingerprinting

Determine the technologies in use on the Web Application (CMS, etc.).

###### Manual Fingerprinting

Look for :
- Verbose HTTP headers disclosing version numbers
```
Server
X-powered-by
X-Generator
...
```
Google any unknown / non-standard headers to discover which technology may
have issued them.  
Load balancers usually use non-standard and misspelled headers.
[*See Server Exposure*](./RECON_Server_exposure.md).
- Default error pages
- Known patterns in HTML source code / URI:

        CMS         | Patterns
        ------------|-----------------------
        WordPress   | 'Powered by WordPress'
                    | /wp-login.php
                    | /wp-admin/
                    | ...
        Joomla      | /\_layouts/*
        Drupal      | /node/*
                    | /CHANGELOG.TXT
                    | /INSTALL.txt
                    | /MAINTAINERS.txt
                    | /LICENSE.txt
                    | ...
        OWAURL      | /OWA/

- Known Cookies:

        Technology  | Cookie
        ------------|-------------------
        Java        | JSESSIONID
        IIS server  | ASPSESSIONID
        ASP.NET     | ASP.NET_SessionId
        Cold Fusion | CFID/CFTOKEN
        PHP         | PHPSESSID

###### Automated Fingerprinting

The following tools can be used to automate the tests above:
```
# whatweb
./whatweb -a 3 <url>
```

### Active spidering & URL bruteforcing

Actively spider the application using all of the already enumerated content as
a starting point.

###### Burp Active Spider
Burp Spider is a tool for automatically parsing HTML source for URL and requesting them, effectively crawling the web application for openly accessible content.  
Start the BurpSuite Active Spidering and complete authentication forms whenever  possible.
```
[Target] Site map -> right click <target> -> Spider this host
```

###### Burp Content Discover
Burp Content Discover uses various techniques to discover content such as spidering, intelligent URI bruteforcing with adapted to the context wordlists, etc.
```
[Target] Site map -> right click <target> -> [Engagement tools] Discover content
```
###### URL bruteforcing

Use the application root and any other path from already enumerated deemed fit
as a starting point.

*File extension*  
Determine file extension to use for the bruteforce (no extension +
language extension).

*Wordlists*  
Adapte the word list for the application context.  
Example: if all resources in start with a capital letter, the wordlist used in
the bruteforce should be capitalized.  
Check for default content associated with the technologies found.
```
# Default URI for various CMS
/Discovery/Web_Content/*

#
/dirbuster/directory-list-2.3-medium.txt
```
*Tools*  
The following tools can be used to bruteforce URI:
```
# GUI
DirBuster
BurpSuite Intruder

# CLI
gobuster
wfuzz
dirb
```
