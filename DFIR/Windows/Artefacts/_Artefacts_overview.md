# DFIR - Windows artefacts overview

A more detailed explanation of the artefacts, and associated parsing tools, are
/ will be available in dedicated sub-notes.

### General

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `EVTX` | General | Overall system usage: Accounts authentication successes and failures, local accounts and groups management, Windows Services or scheduled tasks operations, PowerShell activity, etc. | - | `%SystemRoot%\System32\winevt\Logs\*` |

### System information

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `HKLM\SYSTEM` <br> - <br> `ComputerName` | System information | Name of the computer. | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName` |
| `HKLM\SYSTEM` <br> - <br> Security `Policy` | System information | Basic information on the system: <br> - Computer name and `SID`. <br> - Computer's domain and domain `SID` (for domain-joined hosts). | Registry keys under `HKLM\SECURITY\Policy`: <br><br> - `PolAcDmN`: computer name <br><br> - `PolAcDmS`: computer `SID` <br><br> - `PolDnDDN`: computer's domain name <br><br> - `PolPrDmS`: computer's domain `SID` | File: `%SystemRoot%\System32\config\SECURITY` |
| `HKLM\SYSTEM` <br> - <br> `TimeZoneInformation` | System information | Time zone information. | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\System\ControlSet001\Control\TimeZoneInformation` |
| `HKLM\SYSTEM` <br> - <br> Network interfaces (`Interfaces`) | System information | Basic information about network interfaces (interface name, associated IP address, default gateway, and DHCP lease and eventual domain) | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry keys: `HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\*` |
| `HKLM\SYSTEM` <br> - <br> `FirewallPolicy` | System information | Windows local Firewall profiles (Public, Private, and Domain) status and configured rules. | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\*` |
| `HKLM\SYSTEM` <br> - <br> `Select` | System information | `ControlSet` information for the `ControlSet001`, `ControlSet002`, ... registry keys: <br><br> - Current `ControlSet` pointed by the `CurrentControlSet` key. <br><br> - Last known good `ControlSet`. | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\SYSTEM\Select` |
| `HKLM\SOFTWARE` / `NTUSER` <br> - <br> Application Registration (`App Paths`) | System information | Applications installed on the system, on a system-wide or per user basis. <br><br> The entries are mainly used by the Windows operating system for two purposes: <br><br> - Mapping an application file name to its executable full path. <br><br> - Pre-pending information to the `PATH` environment variable on a per-application and per-process basis. | Applications installed system-wide have their information written in the `HKLM\SOFTWARE` registry hive, while applications installed per user have their information written in the user `NTUSER` hive. <br><br> For each installed application the following notable information is available: <br><br> - File name and full file path of the application executable. <br><br> - Timestamp of installation. | For system-wide applications: <br> File: <br> `%SystemRoot%\System32\config\SOFTWARE` <br> Registry key: `Microsoft\Windows\CurrentVersion\App Paths` <br><br> For per-user applications: <br> File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\Software\Microsoft\Windows\CurrentVersion\App Paths` |

### Program execution

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `EVTX` <br> - <br> `Security.evtx` <br> - <br> Process creation | Programs execution | For more information: <br> [Program execution note](../TTPs_Analysis/Program_execution.md). | Event `4688`: `A new process has been created` <br> Event `4689`: `Process Termination: Success and Failure` <br><br> Requires `Audit Process Creation` to be enabled. <br><br> If the `ProcessCreationIncludeCmdLine_Enabled` audit policy is enabled, the command line specified at the process creation will be logged. | `Security.evtx` |
| `HKLM\SYSTEM` <br> - <br> `Application Compatibility Cache` (`Shimcache`) | Programs execution | Application compatibility feature that aim to maintain support of existing software to new versions of the Windows operating system. <br><br> `Shimcache` entries are only written to the registry upon shutdown of the system. The `Shimcache` entries generated since the last system boot are thus only stored in memory. <br><br> For more information: [Shimcache note](./Shimcache.md). | Each `Shimcache` entries contain the notable information: <br><br> - The associated file full path. <br><br> - The `LastModifiedTime` (`$Standard_Information`) timestamp of the file, which does not necessarily reflect the execution time. <br><br> - On Windows 2003 / XP 64-bit and older, the file size. <br><br> - On Windows Vista / Windows Server 2008, the (undocumented) `Process Execution Flag` flag which seems to indicate whether the entry was executed. <br><br> - On `Windows XP 32-bit`, the file `Last Update Time` timestamp.| File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache` |
| `NTUSER` <br> - <br> `UserAssist` | Programs execution | Executions of programs with a graphical interface, installed or from a portable executable. The purpose of the `UserAssist` registry key is not official documented. | One or two main registry subkeys can be found depending on the Windows OS version: <br><br> - On Windows Xp, `{75048700-EF1F-11D0-9888-006097DEACF9}` linked to execution of executable files <br><br> - Starting from Windows 7, `{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}` linked to execution of executable files and `{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}` linked to execution of shortcut files. <br><br> Keys are `ROT13` encoded, and contains the following notable information: <br><br> - Full path of the executed program / shortcut. <br><br> - Sometimes, the timestamp of the last execution. <br><br> - An unreliable run counter. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\<GUID>\Count` |
| `System Resource Usage Monitor (SRUM)` <br><br> Introduced in Windows 8. | Programs execution | Feature that records numerous metrics of system activities, with a limited subset displayed within the Windows `Task Manager` ("App history" tab). <br><br> For more information: [SRUM note](./SRUM.md). | The Resources usage (table `{D10CA2FE-6FCF-4F6D-848E-B2E99266FA89}`) can help track programs execution. For each execution entry, the following information may be recorded: <br><br> - The timestamp of execution. <br><br> - Full path of the executable or application information / description for built-in components. <br><br> - User `SID` of the user executing the process. <br><br> - Metrics on CPU usage (CPU time in foreground and background). <br><br> - Metrics on I/O operations (foreground / background number of read / write operations and bytes read / written). | `%SystemRoot%\System32\SRU\SRUDB.dat` |
| Windows 10 Timeline / `ActivitiesCache.db` <br><br> Introduced in Windows 10's version 1803.	| Programs execution | XXX <br><br> For more information: [ActivitiesCache.db note](./ActivitiesCache_db.md). | XXX | `C:\Users\<USERNAME>\AppData\Local\ConnectedDevicesPlatform\L.<USERNAME>\ActivitiesCache.db` |
| `Prefetch` <br><br> Not present by default on Windows Server Operating Systems. | Programs execution | Linked to a performance enhancement feature that enables prefetching of applications to make system boots or applications startups faster. <br><br> For more information: [Prefetch note](./Prefetch.md). | Each Prefecth file can yield the following information: <br><br> - The file name and size of the binary executed. <br><br> - The first and last eight executions timestamps <br><br> - The run count (number of time the binary was executed). <br><br> - The list of files and directories accessed during the first ten seconds of execution (including the eventual `DLL` loaded or PowerShell scripts for PowerShell execution). | `Prefetch` files (`.PF`) in: <br> `%SystemRoot%\Prefetch\*` |
| `HKLM\SYSTEM` <br> - <br> `Background Activity Moderator (BAM)` <br> / <br> `Desktop Activity Moderator (DAM)` <br><br> Introduced in Windows 10's Fall Creators update - version 1709. | Programs execution | `BAM` is a mostly undocumented feature that controls the programs executed in the background. `DAM` is a feature for devices supporting the "Connected Standby" mode (i.e when a device is turned on, but its display will be turned off). As a result, the `BAM` registry keys will contain data on any devices, while `DAM` registry keys will only contain data on mobile devices. | The `BAM` registry key contains multiple subkeys under `bam\State\UserSettings`, with one subkey per user, identified with the user `SID`. While the key is in the `SYSTEM` registry hive, program executions can thus still be tied to a specific user using this `SID`. <br><br> Each user-specific key contains a list of executed programs, with their full path and timestamp of last execution. <br><br> If a file is deleted, the eventual associated entry in the `BAM` is deleted as well after the system reboot. Additionally, `BAM` entries older than 7 days are deleted upon system boot. The `BAM` thus provides limited information on historic execution of programs. <br><br> No entries are created in the `BAM` keys for executables on removable media and/or on network shares. | File: `%SystemRoot%\System32\config\SYSTEM` <br><br> Registry key: <br> `HKLM\SYSTEM\CurrentControlSet\Services\bam\UserSettings\<SID>\*` <br> After from Win10 1809: `HKLM\SYSTEM\CurrentControlSet\Services\bam\State\UserSettings\<SID>\*` |
| `Amcache` <br><br> Starting from Windows 7 & Windows Server 2008 R2 | Programs execution | XXX <br><br> For more information: [Amcache note](./Amcache.md). | XXX | `%SystemRoot%\AppCompat\Programs\Amcache.hve` |
| `RecentFileCache` <br><br> Replaced by `Amcache.hve` on Windows 7 (patched) and later operating systems. | Programs execution | `%SystemRoot%\AppCompat\Programs\RecentFileCache.bcf` |
| `NTUSER` <br> - <br> `FeatureUsage` <br><br> Introduced in Windows 10's version 1903. | Programs execution | Feature linked to the Windows Task, storing a number of metrics related to the Task bar usage. | Each operation (detailed below) is associated with an entry composed of the program full path and operation run count. No timestamp of execution is available. <br><br> Subregistry keys: <br><br> - `AppSwitched`: number of times an application was brought to focus (application left-clicked on the taskbar). <br><br> - `ShowJumpView`: number of times the jump menu of an application was opened (application right-clicked on the taskbar). <br><br> - `AppBadgeUpdated`: number of times an application on the taskbar has have its icon updated (for example for notifications). <br><br> - `AppLaunch`: number of times an application pinned on the taskbar has been executed. <br><br> - `TrayButtonClicked`: numer of times a default taskbar button (such as the Windows start button) was clicked. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br><br> Registry keys under ` HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FeatureUsage`. |
| `NTUSER` <br> - <br> `RecentApps` <br><br> Introduced in Windows 10 1607 and removed in Windows 10 1709 (with the key not present on subsequent version). | Programs execution | Undocumented feature, added and (relatively) shortly after removed from the Windows operating system. | Each subkey, identified with a GUID, under the `RecentApps` key correspond to an executed program. In these application GUID subkeys, the filename, last access timestamp, and run count of the application are stored. <br><br> Additionally, each application GUID subkey can have up to 10 subkeys, also identified with a GUID, that correspond to files accessed using the application. In these file GUID subkeys, the file name, file full path, and (on some OS version) an non-updated timestamp of last access. <br><br> The last write timestamp of an application subkey can indicate when the program was last executed. While the last write timestamp of a file subkey can indicate when the file was accessed (with the associated program). | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\RecentApps\<GUID>` |
| `Jumplist` | Programs execution | Detailed in `Files and folders access` | - | - |
| `NTUSER` <br> - <br> Common Dialogs <br> - <br> `CIDSizeMRU` | Programs execution | Recently executed programs, linked to `Common Dialogs` activities (pop boxes to open / save file, print, find / replace, ...). | The key contains an ordered `Most Recently Used (MRU)` list of executed programs, identified through their filename. <br><br> The last write timestamp of the key thus corresponds to the timestamp of execution of the most recently executed program (first in the MRU list). | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\CIDSizeMRU` |
| `NTUSER` <br> - <br> Common Dialogs <br> - <br> `LastVisitedMRU ` <br> / <br> `LastVisitedPidlMRU` <br> `LastVisitedPidlMRULegacy` <br> Renamed in Windows Vista and later. | Programs execution | Records the programs used to open / save (some of) the file tracked in the `OpenSaveMRU` / `OpenSavePidlMRU` registry key. <br><br> Notably used to track the last folder used by a given program in an "Open File" / "Save File" `Common Dialogs` window. | Applications tracked are stored in an ordered `Most Recently Used (MRU)` list. The last write timestamp of the key thus corresponds to the timestamp of execution of the most recently executed program (first in the MRU list). <br><br> For each application, the full path of the folder can be constructed from information blocks on each subfolder in the location. For exemple, for the "C:\Users\Public\Documents" location, three blocks will be present: "Users", "Public", and "Documents". For each block, the created and last accessed timestamps and the MFT entry / sequence associated with the folder are referenced. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br><br> Registry key: <br> `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedMRU` <br> `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU` <br> `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRULegacy` |
| `NTUSER` <br> - <br> `RunMRU` | Programs execution | Tacks items (program, files / folders, `URL`, ...) entered in the Windows Run launcher (Windows + R shortcut). <br><br> Entries are added / updated in near real-time. | Entries contain the items entered in the Windows Run launcher, in an ordered `Most recently used (MRU)` list. <br><br> The last write timestamp of the key thus indicates the timestamp of the most recently entered item. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU` |

### Filesystem

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `MFT` | Filesystem | Main element of any `NTFS` partition with the MFT, filename `$MFT`, being the first file of the partition. <br><br> The MFT contains an entry for all existing files written on the partition. Deleted files that were once written on the partition may also still have a record in the MFT. <br><br> For more information: [MFT note](./MFT.md). | Each record entry in the MFT notably includes: <br><br> - The filename. <br><br> - The file size. <br><br> - The file creation, last modified, last accessed, last changed `SI` timestamps (`MACB`) in the `$STANDARD_INFORMATION` attribute. <br><br> - The file creation, last modified, last accessed, last XXX `FN` timestamps (`MACB`) in the `$FILE_NAME` attribute. <br><br> - File access permissions. <br><br> - ... <br><br> For more information on Windows timestamps: <br> [Windows timestamps note](./Timestamps.md). | `%SystemDrive%:\$MFT` |
| `UsnJrnl` | Filesystem | Feature of `NTFS`, activated by default on Vista and later, which maintains a record of changes made to the `NTFS` volume. The creation, deletion or modification of files or directories are; among other operations, journalized. <br><br> The records in the `UsnJrnl` are progressively overwritten once the max size of the journal has been reached. The `UsnJrnl` usually contains historical data on the last few days (1-3 days for system full time use, < 7 days for regular system use). | The `UsnJrnl` is composed of two data streams: <br><br> - The `$Max` data stream stores the meta data of the change. <br><br> - The `$J` data stream stores the actual change log records. <br><br> Each change log record is notably composed of: <br><br> - an `Update Sequence Number (USN)`. <br><br> - The timestamp of the change. - The reason / operation of the record (`USN_REASON_FILE_CREATE`, `USN_REASON_FILE_DELETE`, `USN_REASON_DATA_OVERWRITE`, `USN_REASON_RENAME_NEW_NAME`, etc.). <br><br> - MFT reference and reference sequence number. | `$Max` and `$J` files under `\$Extend\$UsnJrnl` |
| `Recycle Bin` | Filesystem (Deleted files) | Deleted files and folders (if deleted through a recycle bin aware application). | Two kind of files are present in the Recycle Bin: <br><br> - `$I` (for "Information") files, which contain the path and timestamp of deletion of the original file. <br><br> - `$R` (for "Resource") files, which contain the original file content. | `%SystemDrive%:\$Recycle.Bin\<USER_SID>\*` |

### Files and folders access

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `NTUSER` <br> - <br> `Shellbag` | Files and folders access | Registry keys designed as an user experience enhancing feature to keep track of Windows explorer graphical display settings on a folder-by-folder basis. For instance, a Shellbag entry is used to store the "View" mode of a folder (details, list, small / medium / large icons) as well as the column displayed (entry names, dates, sizes, etc.) and their order. <br><br> For more information: [Shellbags note](./Shellbags.md). | Various kinds of user activity may generate or update Shellbag entries (with different level of data depending on the activity): <br><br> - First access or renaming of folders, removable devices, or network shares through the Windows Explorer systematically generate a Shellbag entry <br><br> - Graphical opening of compressed archives or ISOs <br><br> - ... <br><br> Each Shellbags entry for a given target yield the following notable information: <br><br> - The target name and absolute path. <br><br> - The target modified, access, and created (MAC) timestamps (UTC), retrieved from the `$MFT` at the Shellbag entry creation (and not further updated). <br><br> Additionally each entry in ShellBags `BagMRU` maintain a `MRUListEx` list, which records the order in which the sub targets of a target were accessed (the last sub target accessed having a `MRU position` of 0). This can be used to deduce the first and last interacted timestamps for some targets. | Starting from Windows 7: <br><br> Files: <br> `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> `%SystemDrive%:\Users\<USERNAME>\AppData\Local\Microsoft\Windows\UsrClass.dat` <br><br> Registry keys: <br> `NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU` <br> `NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags` <br> `UsrClass.dat\Local Settings\Software\Microsoft\Windows\Shell\BagMRU` <br> `UsrClass.dat\Local Settings\Software\Microsoft\Windows\Shell\Bags` |
| `Jumplist` | Files and folders access | Linked to a taskbar user experience-enhancing feature that allows users to "jump" to files, folders or others elements by right clicking on open applications in the `Windows taskbar`. The `Windows Explorer`'s `Quick Access` feature also stores entries in `Jumplists`. <br><br> Two forms of `Jumplists` are created: <br> - automatic entries for recently accessed items: `*.automaticDestinations-ms` files. <br> - custom entries in `*.customDestinations-ms` files for items manually "pinned" elements: `*.customDestinations-ms` <br><br> For more information: [Jumplist note](./Jumplist.md). | Each application `AutomaticDestinations` and `CustomDestinations` JumpLists are assimilable to a series of `shortcut files (LNK)`. <br><br> Each entry (shortcut) in an application `AutomaticDestinations` or `CustomDestinations` JumpList thus contains the same level of information found in a `shortcut file`. | `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations\*.automaticDestinations-ms` <br><br> `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent\CustomDestinations\*.customDestinations-ms` |
| `LNK (shortcuts) Files` | Files and folders access | Windows Shell Items that reference an original file, folder, or application. <br><br> While `shortcut files` can be created manually, the Windows operating system also creates `shortcut files` under numerous user activities, such as opening of a non-executable file. For instance, a `shortcut file` is created under `[...]\AppData\Roaming\Microsoft\Windows\Recent\` whenever a file is opened from the `Windows Explorer`. <br><br> For more information: [LNKFile note](./LNKFile.md). | The creation and modification timestamps of the shortcut file itself will usually respectively indicate when the target file was first and last opened. <br><br> Each shortcut file additionally yield the following information: <br><br> - The target file's absolute path, size and attributes (hidden, read-only, etc.). <br><br> - The target file modified, access, and created (MAC) timestamps at the time of the last access to the target file. <br><br> - Whether the target file was stored locally or on a remote network share. <br><br> - Occasionally information on the volume of the target file: name, type (fixed vs removable storage media), serial number, and label / name if any. <br><br> - Occasionally information on the host of the target file: system's NetBIOS hostname and MAC address. | Automatically created `shortcut files` for files opened from the Windows Explorer: <br> `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent\*.lnk` <br><br> Documents opened using `Microsoft Office`: <br> `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Office\Recent\*.lnk` <br><br> `Shortcut files` created automatically by the `Windows Explorer` are referenced in the `NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs` registry keys. <br><br> `Startup folders` items: <br> `%SystemDrive%:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp` <br> `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup` <br><br> |
| Windows 10 Timeline / `ActivitiesCache.db` <br><br> Introduced in Windows 10's version 1803. | Files and folders access | Detailed in `Program execution` | - | - |
| `NTUSER` <br> - <br> Common Dialogs <br> - <br><br> `OpenSaveMRU` <br><br> `OpenSavePidlMRU` <br> Renamed in Windows Vista and later. | Files and folders access | Information on files opened or saved through the "Open File" or "Save File" `Common Dialogs` window. | The `OpenSaveMRU`/ `OpenSavePidlMRU` keys has multiple subkeys, one for each different file extensions (for the files opened / saved on the given system). <br><br> Each subkey contains an ordered `Most recently used (MRU)` list of opened / saved files (full path of the file). The list can go up to 20 entries, with entries over 20 being overwritten. <br><br> The last write timestamp of each subkey thus corresponds to the timestamp of opening / saving of the file in MRU position 0 (for a given file extension). | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br><br> Registry key: <br> `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSaveMRU` <br> `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU` |
| `NTUSER` <br> - <br> `RecentDocs` | Files and folders access | Non-executable files opened through the Windows Explorer, stored as one subkey per file extension. | Each subkey contains the opened files of the given extension stored in a ordered `Most Recently Used (MRU)` list. The last written timestamp of the key correspond to the timestamp of the opening of the most recently accessed file (MRU position 0). <br><br> Entry created under the RecentDocs registry keys are associated with a shortcut file under `%SystemDrive%:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent\`. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs` |
| `NTUSER` <br> - <br> `Map Network Drive MRU` | Files and folders access | Recently used network shares. | - | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br><br> Registry key: <br> `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU` |
| `NTUSER` <br> - <br> `TypedPaths` | Files and folders access | Paths entered (typed, pasted, or auto-completed) in the Windows Explorer location or search bars. <br><br> Entries are not added / updated in real-time, but are seemingly added / updated on user logoff / system reboot. | The file paths are stored as `url1` to `url[N]` in inversed chronological order. <br><br> The last write timestamp of the key is thus the timestamp of visit of the most recently visited path. <br><br> As program can be directly executed from the Windows Explorer search bar, traces of program executions may be found in the `TypedPaths` entries. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths` |
| `NTUSER` <br> - <br> `WordWheelQuery` <br><br> Starting from Windows 7 and not present on Windows Server Operating Systems. | Files and folders access | Keywords searched in from the Windows start menu, potentially resuling in files or folders access or program execution. | The entries are stored in a `Most Recently Used (MRU)` list. The last write timestamp of the key indicates the timestamp of the most recently searched keyword. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery` |
| `NTUSER` <br> - <br> `RunMRU` | Files and folders access | Detailed in `Program execution`. | - | - |
| `NTUSER` <br> - <br> `RecentApps` <br><br> Introduced in Windows 10 1607 and removed in Windows 10 1709 (with the key not present on subsequent version). | Files and folders access | Detailed in `Program execution`. | - | - |
| Windows Search | Files and folders access | `%SystemDrive%:\ProgramData\Microsoft\Search\Data\Applications\Windows\Windows.edb` |

### Remote Access / Lateral movements

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `EVTX` <br> - <br> `Security.evtx` <br> - <br> Authentication (destination machine) | Remote Access / Lateral movements | For more information: <br> [accounts usage note](../TTPs_Analysis/Accounts_usage.md). | Event `4624`: `An account was successfully logged on` <br><br> Event `4625`: `An account failed to log on` <br><br> Event `4672`: `Special privileges assigned to new logon` <br><br> Event `4647`: `User initiated logoff` <br><br> Event `4634`: `An account was logged off` | `Security.evtx` |
| `EVTX` <br> - <br> `Security.evtx` <br> - <br> Authentication (source machine) | Remote Access / Lateral movements | For more information: <br> [accounts usage note](../TTPs_Analysis/Accounts_usage.md). | Only logged whenever alternate credentials are used: <br><br> Event `4648: A logon was attempted using explicit credentials` | `Security.evtx` |
| `EVTX` <br> - <br> `Security.evtx` <br> - <br> Authentication (AD DS Domain Controller) | Remote Access / Lateral movements | For more information: <br> [accounts usage note](../TTPs_Analysis/Accounts_usage.md). | Event `4624`: `An account was successfully logged on` <br><br> Event `4625`: `An account failed to log on` <br><br> Event `4768`: `A Kerberos authentication ticket (TGT) was requested` <br><br> Event `4769`: `A Kerberos service ticket was requested` <br><br> Event `4771`: `Kerberos pre-authentication failed` <br><br> Event `4776`: `The domain controller attempted to validate the credentials for an account` | `Security.evtx` |
| `EVTX` <br> - <br> Remote Desktop access events (destination machine) | Remote Access / Lateral movements | For more information: <br> [lateral movement note](../TTPs_Analysis/Lateral_movement.md). | `Microsoft-Windows-TerminalServices-RemoteConnectionManager%4Operational.evtx`: <br> - Event `1149`: `Remote Desktop Services: User authentication succeeded`. Access to the Windows login screen (not necessarily a successful session opening). <br><br> `Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational`: <br> - Event `21`: `Remote Desktop Services: Session logon succeeded`.<br> - Event `22`: `Remote Desktop Services: Shell start notification received` <br> - Event `23`: `Remote Desktop Services: Session logoff succeeded` <br> - Event `25`: `Remote Desktop Services: Session reconnection succeeded` <br><br> `Microsoft-WindowsRemoteDesktopServicesRdpCoreTS%4Operational.evtx`: <br> - Event `131`: `The server accepted a new TCP connection from client <IP>`. Introduced in `>= Windows Server 2012`, only indicate a network access to the RDS service. | `Microsoft-Windows-TerminalServices-RemoteConnectionManager%4Operational.evtx` <br><br> `Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational` <br><br> `Microsoft-WindowsRemoteDesktopServicesRdpCoreTS%4Operational.evtx` |
| `EVTX` <br> - <br> Remote Desktop access events (source machine) | Remote Access / Lateral movements | For more information: <br> [lateral movement note](../TTPs_Analysis/Lateral_movement.md). | `Microsoft-WindowsTerminalServicesRDPClient%4Operational.evtx`: <br> - Event `1024`: `RDP ClientActiveX is trying to connect to the server (<HOSTNAME>)` <br> Event `1102`: `The client has initiated a multi-transport connection to the server <IP>.` | `Microsoft-WindowsTerminalServicesRDPClient%4Operational.evtx` |
| `EVTX` <br> - <br> Windows services events (destination machine) | Remote Access / Lateral movements | For more information: <br> [local persistence note](./Local_persistence.md). | `System.evtx`: <br> - Event `7045`: `A service was installed in the system` <br> - Event `7036`: `The <SERVICE_NAME> service entered the <running/stopped> state` <br><br> `Security.evtx`: <br> - Event `4697`: `A service was installed in the system`. Introduced in Windows Server 2016 and Windows 10, and requires advanced auditing policy. | `System.evtx` <br><br> `Security.evtx` |
| `EVTX` <br> - <br> Scheduled tasks events (destination machine) | Remote Access / Lateral movements | For more information: <br> [local persistence note](./Local_persistence.md). | `Microsoft-Windows-TaskScheduler%4Operational.evtx`, events introduced in `Windows 7` / `Windows 2008`: <br> - Event `106`: `User "<DOMAIN \| WORKGROUP>\<USERNAME>" registered Task Scheduler task "\<TASK_NAME>"` <br> - Event `140`: `User "<DOMAIN \| WORKGROUP>\<USERNAME>" updated Task Scheduler task "<TASKNAME>"` <br> - Event `200`: `Task Scheduler launched action "<EXECUTABLE>" in instance "<GUID>" of task "<TASKNAME>"` <br> - Event `201`: `Task Scheduler successfully completed task "<TASKNAME>", instance "<GUID>", action "<EXECUTABLE>" with return code <INT>"` <br> - Event `141`: `User "<DOMAIN \| WORKGROUP>\<USERNAME>" deleted Task Scheduler task "<TASKNAME>"` <br><br> `Security.evtx`, requires advanced auditing policy: <br> - Event `4698`: `A scheduled task was created` <br> - Event `4700: A scheduled task was enabled` <br> - Event `4701`: `A scheduled task was disabled` <br> - Event `4702`: `A scheduled task was updated` <br> - Event `4699`: `A scheduled task was deleted` | `Microsoft-Windows-TaskScheduler%4Operational.evtx` |
| `EVTX` <br> - <br> PowerShell remoting (`WinRM`) events (destination machine) | Remote Access / Lateral movements | For more information: <br> [PowerShell activity note](./PowerShell_activity.md). | `Microsoft-Windows-PowerShell\Operational`: <br> - Event `4103`, related to PowerShell modules. Requires PowerShell `Module Logging` to be enabled. <br> - Event `4104`, related to PowerShell script block. Requires PowerShell `Script Block Logging` to be enabled. | `Microsoft-Windows-PowerShell\Operational` |
| `User Access Logging (UAL)` <br><br> Windows Server only, introduced in Windows Server 2012. | Remote Access / Lateral movements | Feature that consolidates data on client activity. <br><br> On Domain Controllers, yield information on sessions opening on domain-joined computers (if the given DC was reached for authentication / `Group Policy` retrieval). <br><br> For more information: [User Access Logging note](./User_Access_Logging.md). | The information is stored locally in up to five `Extensible Storage Engine (ESE)` database files (`.mdb`), including: <br><br> - The `Current.mdb` file which contains data for the last 24-hour. <br><br> - Up to three `<GUID>.mdb` files, which contain data for an entire year (first to last day), going back to 2 years. <br><br> The `CLIENTS` table of the aforementioned databases contain notable information: <br><br> - Accessed Windows Server role `GUID` and description (`AD DS`, `AD CS`, `SMB / CIFS` service notably) <br><br> - The client domain and username. <br><br> - Total number of access. <br><br> - First, last, and daily access timestamps. <br><br> - Client `IPv4` or `IPv6` address. <br><br> On Domain Controllers, the hostname associated with a given `IP` address at that time may be retrievable as machine accounts of domain-joined computers also authenticate to `AD DS`. | Database files (`.mdb`) in `%SystemRoot%\System32\Logfiles\SUM\` |
| `NTUSER` <br> - <br> `Terminal Server Client\Servers` | Remote Access / Lateral movements | IP address of the remote host(s) the user connected to (from the local system), stored as one key per remote host. | For each key: <br><br> - The `UsernameHint` value contains the eventual saved username for the connection. <br><br> - The last written timestamp may be an indicator of the first access to the remote host (but can also be updated for various other reasons). | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Terminal Server Client\Servers\<IP>` |
| `SSHlogs` | Remote Access / Lateral movements | `OpenSSH` for Windows logs in a text format. Not enabled by default (requires `SyslogFacility LOCAL0` / `LogLevel Debug3`) to be set in the server `sshd_config`. | Contains information about users successful and unsuccessful authentication attempts (with the associated IP source). | `%ProgramData%\ssh\logs` |
| `RDP Bitmap Cache` | Remote Access / Lateral movements | Partial captures of the remote desktop screen from the Remote Desktop Client for RDP sessions. <br><br> Implemented to reduce the amount of data sent by the server to save bandwidth usage. <br><br> Bitmap caching be deactivated client-side in the Remote Desktop Client. | - | Windows XP / Windows Server 2003: <br> `%SystemDrive%:\Documents and Settings\<USERNAME>\Local Settings\Application Data\Microsoft\Terminal Server Client\Cache\*` <br><br> Windows 7 and later: `%SystemDrive%:\Users\<USERNAME>\AppData\Local\Microsoft\Terminal Server Client\Cache\*` |
| `HKLM\SYSTEM` <br> - <br> `ProfileList` | Remote Access / Lateral movements | `SID` to username correspondence for accounts that have logged on the system (including for domain accounts). | The last write timestamp of each key indicates was the associated user last logged on the system. | File: `%SystemRoot%\System32\config\SOFTWARE` <br> Registry key: `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList` |
| `HKLM\SYSTEM` <br> - <br> `PortProxy` | Remote Access / Lateral movements | `netsh` port forwarding activity: listening host / port and remote host / port. | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\SYSTEM\ControlSet001\Services\PortProxy\v4tov4\tcp\*` |

### Local persistence

For artefacts on local persistence and `AutoStart Extensibility Point (ASEP)`,
refer to:

 - The [local persistence note](./Local_persistence.md).

 - The [persistence-info repository](https://persistence-info.github.io/).

### Web browsing history

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `NTUSER` <br> - <br> `TypedURLs` | Web browsing history | `URL` entered (typed, pasted, or auto-completed) in the `Internet Explorer (IE)` web browser search bar. <br><br> Web searches do not generate entries, only typing of an `URL` will. <br><br> Entries are added / updated in near real-time. | The `URL` are stored as `url1` to `url[N]` in inversed chronological order. <br><br> The last write timestamp of the key is thus the timestamp of visit of the most recently visited `URL`. | File: `%SystemDrive%:\Users\<USERNAME>\NTUSER.dat` <br> Registry key: `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\TypedURLs` |

### Network usage

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `System Resource Usage Monitor (SRUM)` <br><br> Introduced in Windows 8. | Network usage | Detailed in `Program execution`. | The Network data usage table (table `{973F5D5C-1D90-4944-BE8E-24B94231A174}`) can help track programs execution and network usage of the executed programs. <br><br> For each execution entry, the following information may be recorded: <br><br> - Timestamp of execution. <br><br> - Full path of the executable or application information / description for built-in components. <br><br> - Metrics on network data usage (bytes sent and receive on a given network interface). | - |
| `HKLM\SYSTEM` <br> - <br> `NetworkList` | Network usage | Basic network historical information (network name and type, first and last connection, etc.) | - | File: `%SystemRoot%\System32\config\SYSTEM` <br> Registry key: `HKLM\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles\` |

### Third-party applications

| Name | Type | Description | Information / interpretation | Location |
|------|------|-------------|------------------------------|----------|
| `Azure`'s PowerShell / CLI activity | Interaction with Azure though the `Az` PowerShell module and `az` CLI utility. | Folder `telemetry`: may contain information on `azurecli` commands (user Azure ID, raw command, etc.). <br><br> Folder `commands`: similar to `telemetry` folder, with less data on the executed `azure cli` commands. <br><br> Folder `ErrorRecords`: details on HTTP requests, and their associated response, that generated an error. | `C:\Users\<USERNAME>\.azure\*` |

### TODO

- PowerShell remoting: `Microsoft-Windows-WinRM%4Operational.evtx`
- Windows 10 Timeline / `ActivitiesCache.db` details
- Amcache / RecentFileCache details
- Windows Search details
- Browsing history
- IconCache.db
- USB activity
- Uninstall registry key
- Services `\CurrentControlSet\Services\`
- WMI `OBJECTS.DATA`

--------------------------------------------------------------------------------

### References

https://blog.1234n6.com/2018/10/available-artifacts-evidence-of.html

SANS posters Windows forensics - https://www.sans.org/posters/windows-forensic-analysis/

https://www.scitepress.org/papers/2017/64167/64167.pdf

http://windowsir.blogspot.com/2013/07/howto-determine-program-execution.html

https://www.sans.org/blog/opensavemru-and-lastvisitedmru/

https://andreafortuna.org/2018/05/23/forensic-artifacts-evidences-of-program-execution-on-windows-systems/

https://dfir.ru/2020/04/08/bam-internals/

https://cellebrite.com/en/analyzing-program-execution-windows-artifacts/

https://blog.1234n6.com/2018/10/available-artifacts-evidence-of.html

https://crucialsecurity.wordpress.com/2011/03/14/typedurls-part-1/

https://www.crowdstrike.com/blog/how-to-employ-featureusage-for-windows-10-taskbar-forensics/

https://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/

https://learn.microsoft.com/en-us/windows/win32/shell/app-registration

https://thinkdfir.com/2020/10/23/when-did-recentapps-go/

https://df-stream.com/2017/10/recentapps/
